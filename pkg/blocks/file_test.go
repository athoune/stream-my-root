package blocks

import (
	"bytes"
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestReadRecipe(t *testing.T) {
	raw := `0 f2e25b21bbbd8feff3e1ad4c97aa4bb0f366a45c7b74c67149538caaf221a83e
1 fc35d296d75cc704d316e75cb13ef57a87022520c9b72587533fc3ab898ba47a
2 a2dc7a5ed662b3759c62256d3ec59977e6a30b2323f6638c3b422cbe8f84d687
3 fd7e16e746cac4316bc64db4253d132b0e5ec51512c631b17c28337a98869bed
4 4a79d45b339f22ed8c9aa7863950e9bcb76e3bfc3f37399848cdff39801a2e75
6 7bad6db5ac76d14ac5b3a11b436a81f6849759a08a9de53589e1febf92bb3777
7 1e331ad3caa219be781a7488213302eb0392464ed9ac1a149dbec144f99718bc
8 fde378bf3aa9f1ee5b1c24aeb1f080e0eec9b310f30b61c204564abe8a5fa433
9 85373549e0e5e3066dcfdae610cff180ddfa6eba41bb6869444bba6025b77b58
10 77af8fcd75962a55e656e15b5a359c084e2fba6df8018cd088982f8477f14f12`
	blocks, err := ReadRecipe(bytes.NewBufferString(raw))
	assert.NoError(t, err)
	assert.Len(t, blocks.Blocks, 10)
	assert.Equal(t, 0, blocks.Blocks[0].Seek)
	assert.Equal(t, "f2e25b21bbbd8feff3e1ad4c97aa4bb0f366a45c7b74c67149538caaf221a83e", blocks.Blocks[0].Hash)
}

func TestDiff(t *testing.T) {
	a := bytes.NewBufferString(`0 f2e25b21bbbd8feff3e1ad4c97aa4bb0f366a45c7b74c67149538caaf221a83e
1 fc35d296d75cc704d316e75cb13ef57a87022520c9b72587533fc3ab898ba47a
2 a2dc7a5ed662b3759c62256d3ec59977e6a30b2323f6638c3b422cbe8f84d687
3 fd7e16e746cac4316bc64db4253d132b0e5ec51512c631b17c28337a98869bed
4 4a79d45b339f22ed8c9aa7863950e9bcb76e3bfc3f37399848cdff39801a2e75
6 7bad6db5ac76d14ac5b3a11b436a81f6849759a08a9de53589e1febf92bb3777
7 1e331ad3caa219be781a7488213302eb0392464ed9ac1a149dbec144f99718bc
8 fde378bf3aa9f1ee5b1c24aeb1f080e0eec9b310f30b61c204564abe8a5fa433
9 85373549e0e5e3066dcfdae610cff180ddfa6eba41bb6869444bba6025b77b58
10 77af8fcd75962a55e656e15b5a359c084e2fba6df8018cd088982f8477f14f12`)
	b := bytes.NewBufferString(`0 55e96706c09604a338c2d40dcce2e7e433e3b0e6fd7073b67b8261a76dd271c0
1 fc35d296d75cc704d316e75cb13ef57a87022520c9b72587533fc3ab898ba47a
2 a2dc7a5ed662b3759c62256d3ec59977e6a30b2323f6638c3b422cbe8f84d687
3 fd7e16e746cac4316bc64db4253d132b0e5ec51512c631b17c28337a98869bed
4 62bf4ff855d65d2226238cb8a2881130ee9f3dcc7b857a1f90d0617ce310b42b
6 b2e026c6d979208ea6ebf5148caadf5f27734e8867a664ca9b879b4e6df4e261
7 1abdb77888f0a2398c1873ad493c2162dbfd5585220a049b90450087bd00e30f
8 5e2d7dd744c18d9dd4398dc25ad34ef567624963e6ffc24075f7a3f469b46dd3
9 033c1b6853e8e1ece8a94ced052abdead8beeca641f84b03cd5faa647edaeca3
10 da68060bfc16d305f5a68f6432f568096e308ca4df6ef5ccb942796197a1d6a7`)
	var err error
	aa, err := ReadRecipe(a)
	assert.NoError(t, err)
	bb, err := ReadRecipe(b)
	assert.NoError(t, err)
	diff := aa.Diff(bb)
	assert.Equal(t, 3, diff)
}
